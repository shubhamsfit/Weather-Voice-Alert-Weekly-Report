<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weather Voice Alert & Weekly Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    /* Base styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 2rem;
      background: #fff;
      color: #222;
      text-align: center;
      transition: background 0.5s, color 0.5s;
    }
    h1 {
      font-size: 2.4rem;
      margin-bottom: 0.2rem;
      text-shadow: 1px 1px 4px #aaa;
    }
    p {
      margin: 0.2rem 0 1.2rem 0;
      font-size: 1.1rem;
      color: #555;
    }
    #status {
      margin: 1rem auto;
      font-size: 1.3rem;
      font-weight: 600;
      color: #444;
      min-height: 1.4rem;
      transition: color 0.5s;
    }

    /* Cards container */
    #current-weather, #weekly-forecast {
      max-width: 380px;
      margin: 1rem auto 2rem auto;
      background: #e1f0ff;
      border-radius: 15px;
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
      padding: 1.5rem 1.3rem;
      transition: background 0.5s;
    }

    /* Current weather */
    #current-weather h2 {
      font-size: 1.8rem;
      margin-bottom: 0.4rem;
      color: #0264d6;
    }
    #current-weather p {
      font-size: 1.15rem;
      margin: 6px 0;
      font-weight: 500;
    }
    #current-weather .condition {
      font-style: italic;
      margin-top: 0.3rem;
      color: #074a9c;
    }

    /* Weekly forecast */
    #weekly-forecast h2 {
      font-size: 1.6rem;
      margin-bottom: 1rem;
      color: #0264d6;
    }
    .card {
      background: #b6dcff;
      border-radius: 12px;
      padding: 12px 15px;
      margin-bottom: 12px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.5s;
    }
    .card .date {
      font-weight: 600;
      font-size: 1rem;
      color: #024a8f;
      width: 90px;
      text-align: left;
    }
    .card .condition {
      flex-grow: 1;
      font-style: italic;
      color: #033a70;
      margin-left: 12px;
      text-align: left;
    }
    .card lottie-player {
      width: 70px !important;
      height: 70px !important;
      margin-left: 10px;
    }
    .card div:last-child {
      font-weight: 600;
      color: #022c57;
      width: 110px;
      text-align: right;
      font-size: 0.9rem;
    }

    /* Buttons */
    #controls {
      max-width: 380px;
      margin: 0 auto 3rem auto;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    button {
      cursor: pointer;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: background-color 0.3s, color 0.3s;
      user-select: none;
    }
    button#theme-toggle {
      background: #0264d6;
      color: #fff;
    }
    button#theme-toggle:hover {
      background: #034dbd;
    }
    button#music-toggle {
      background: #4caf50;
      color: #fff;
    }
    button#music-toggle:hover {
      background: #3b8e3b;
    }

    /* Night theme */
    body.night {
      background: #12172d;
      color: #ddd;
    }
    body.night #status {
      color: #a3b1ff;
    }
    body.night #current-weather, body.night #weekly-forecast {
      background: #1f2946;
      box-shadow: 0 8px 20px rgba(25,30,65,0.7);
    }
    body.night #current-weather h2,
    body.night #weekly-forecast h2,
    body.night .card .date,
    body.night .card .condition,
    body.night .card div:last-child {
      color: #a3b1ff;
    }
    body.night button#theme-toggle {
      background: #9fa8ff;
      color: #12172d;
    }
    body.night button#theme-toggle:hover {
      background: #828fef;
    }
    body.night button#music-toggle {
      background: #81c784;
      color: #12172d;
    }
    body.night button#music-toggle:hover {
      background: #66bb6a;
    }
  </style>
</head>
<body>
  <h1>‚õàÔ∏è Weather Voice Alert & Weekly Report</h1>
  <p>Notifies about bad weather alerts and shows current + weekly weather forecast.</p>

  <div id="controls">
    <button id="theme-toggle" onclick="toggleTheme(this)">üåô Night Mode</button>
    <button id="music-toggle" onclick="toggleMusic()">üîà Enable Sound</button>
  </div>

  <div id="status">Loading weather data...</div>

  <div id="current-weather"></div>
  <div id="weekly-forecast"></div>

  <audio id="bg-music" loop></audio>

<script>
  const API_KEY = '3ed08d684f2544ada8270823250108'; // <-- Replace with your WeatherAPI.com API key
  const statusDiv = document.getElementById('status');
  const currentDiv = document.getElementById('current-weather');
  const weeklyDiv = document.getElementById('weekly-forecast');
  const themeBtn = document.getElementById('theme-toggle');
  const musicBtn = document.getElementById('music-toggle');
  const audio = document.getElementById('bg-music');

  let musicEnabled = false;

  // Weather sounds by condition
  const weatherSounds = {
    rain: "https://cdn.pixabay.com/download/audio/2023/04/01/audio_7fdb69a48b.mp3?filename=rain-ambient-10865.mp3",
    thunder: "https://cdn.pixabay.com/download/audio/2022/03/23/audio_6a78f27c88.mp3?filename=thunder-ambient-10839.mp3",
    clear: "https://cdn.pixabay.com/download/audio/2023/04/23/audio_6b7b41a20b.mp3?filename=forest-birds-nature-ambience-10071.mp3",
    cloudy: "https://cdn.pixabay.com/download/audio/2023/03/20/audio_9c5b02a3e6.mp3?filename=wind-ambient-8126.mp3"
  };

  // Map WeatherAPI condition text to Lottie animation URLs (from public LottieFiles)
  function getIconURL(conditionText) {
    const cond = conditionText.toLowerCase();
    if (cond.includes("rain") || cond.includes("shower")) {
      return "https://assets8.lottiefiles.com/packages/lf20_iwmd6pyr.json";
    } else if (cond.includes("thunder") || cond.includes("storm")) {
      return "https://assets3.lottiefiles.com/packages/lf20_vnikrcia.json";
    } else if (cond.includes("snow")) {
      return "https://assets7.lottiefiles.com/packages/lf20_sxkzk8ba.json";
    } else if (cond.includes("cloud")) {
      return "https://assets10.lottiefiles.com/packages/lf20_jvvj5bpc.json";
    } else if (cond.includes("clear") || cond.includes("sun")) {
      return "https://assets1.lottiefiles.com/packages/lf20_hzvolzbn.json";
    } else {
      return "https://assets2.lottiefiles.com/packages/lf20_tutvdkg0.json"; // default weather icon
    }
  }

  // Text-to-speech alert
  function speakAlert(message) {
    const utter = new SpeechSynthesisUtterance(message);
    utter.lang = 'en-US';
    speechSynthesis.speak(utter);
  }

  // Set background music based on condition
  function setMusic(conditionText) {
    const cond = conditionText.toLowerCase();
    let src = weatherSounds.clear;
    if (cond.includes("rain")) src = weatherSounds.rain;
    else if (cond.includes("thunder")) src = weatherSounds.thunder;
    else if (cond.includes("cloud")) src = weatherSounds.cloudy;
    else if (cond.includes("clear") || cond.includes("sun")) src = weatherSounds.clear;

    // Only change source if different
    if (audio.src !== src) {
      audio.pause();
      audio.src = src;
    }

    if (musicEnabled) {
      audio.play().catch(err => {
        console.warn("Playback blocked by browser. Please interact with the page.");
      });
    }
  }

  // Toggle music play/pause on button click
  function toggleMusic() {
    musicEnabled = !musicEnabled;
    musicBtn.innerText = musicEnabled ? "üîá Mute Sound" : "üîà Enable Sound";

    if (musicEnabled) {
      if (audio.src) {
        audio.play().catch(err => {
          console.warn("Playback failed: ", err);
        });
      }
    } else {
      audio.pause();
    }
  }

  // Toggle between Day and Night themes
  function toggleTheme(btn) {
    document.body.classList.toggle("night");
    const isNight = document.body.classList.contains("night");
    btn.innerText = isNight ? "‚òÄÔ∏è Day Mode" : "üåô Night Mode";
  }

  // Fetch weather and update UI
  function getWeatherAndAlert(lat, lon) {
    const url = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${lat},${lon}&days=7&alerts=yes`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          statusDiv.innerText = 'API error: ' + data.error.message;
          return;
        }

        // Current weather
        const current = data.current;
        const currentIcon = getIconURL(current.condition.text);

        currentDiv.innerHTML = `
          <h2>üìç Current Weather - ${data.location.name}, ${data.location.region}</h2>
          <p><strong>Temperature:</strong> ${current.temp_c}¬∞C</p>
          <p class="condition">${current.condition.text}</p>
          <lottie-player src="${currentIcon}" background="transparent" speed="1" style="width: 100px; margin: auto;" autoplay loop></lottie-player>
        `;

        // Weekly forecast
        weeklyDiv.innerHTML = '<h2>üìÖ 7-Day Forecast</h2>';
        data.forecast.forecastday.forEach(day => {
          const dateStr = new Date(day.date).toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
          const iconURL = getIconURL(day.day.condition.text);
          weeklyDiv.innerHTML += `
            <div class="card">
              <div class="date">${dateStr}</div>
              <div class="condition">${day.day.condition.text}</div>
              <lottie-player src="${iconURL}" background="transparent" speed="1" autoplay loop></lottie-player>
              <div>üå° Min: ${day.day.mintemp_c}¬∞C | Max: ${day.day.maxtemp_c}¬∞C</div>
            </div>
          `;
        });

        // Alerts
        const alerts = data.alerts?.alert || [];
        const severe = alerts.find(a => /storm|rain|hail|flood|thunder|snow/i.test(a.event));
        if (severe) {
          const msg = `‚ö†Ô∏è Weather Alert: ${severe.event}. ${severe.headline}`;
          speakAlert(msg);
          statusDiv.innerText = msg;
        } else {
          statusDiv.innerText = '‚úÖ No severe weather alerts currently.';
        }

        // Set background music based on current condition
        setMusic(current.condition.text);
      })
      .catch(err => {
        statusDiv.innerText = 'Fetch error: ' + err.message;
        console.error(err);
      });
  }

  // On page load, get location and start weather checks
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        statusDiv.innerText = "üìç Location detected. Fetching weather data...";
        getWeatherAndAlert(lat, lon);
        setInterval(() => getWeatherAndAlert(lat, lon), 5 * 60 * 1000); // every 5 mins
      },
      err => {
        statusDiv.innerText = "‚ùå Location error: " + err.message;
      }
    );
  } else {
    statusDiv.innerText = "‚ùå Geolocation is not supported by this browser.";
  }
</script>
</body>
</html>
